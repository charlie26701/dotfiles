#!/usr/bin/env bash

pkg_installed() {
	local PKG=$1
	if pacman -Qi $PKG &>/dev/null; then
		return 0
	else
		return 1
	fi
}
cd ~

# Font
sudo pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji --noconfirm && yay -S ttf-ms-win11-auto ttf-ms-win11-auto-japanese ttf-ms-win11-auto-korean ttf-ms-win11-auto-zh_cn --noconfirm
echo "[*] Copy fonts ..."
ln -s ~/Dotfiles/dotf/.fonts ~/.fonts
fc-cache -fv
echo "[*] Done."
sleep 3 && clear

# Icon theme && Cursor theme
echo "[*] Copy icons ..."
ln -s ~/Dotfiles/dotf/.icons ~/.icons
echo "[*] Done."
sleep 3 && clear

# Themes
echo "[*] Copy themes ..."
ln -s ~/Dotfiles/dotf/.themes ~/.themes
echo "[*] Done."
sleep 3 && clear

# Config
echo "[*] Copy config ..."
if ! [ -d $HOME/.config ]; then
	mkdir -p $HOME/.config
fi
ln -s ~/Dotfiles/dotf/.config/alacritty ~/.config/alacritty
ln -s ~/Dotfiles/dotf/.config/zsh ~/.config/zsh
ln -s ~/Dotfiles/dotf/.config/ranger ~/.config/ranger
ln -s ~/Dotfiles/dotf/.config/gtk-3.0 ~/.config/gtk-3.0
ln -s ~/Dotfiles/dotf/.config/gtk-4.0 ~/.config/gtk-4.0
ln -s ~/Dotfiles/dotf/.config/picom ~/.config/picom
ln -s ~/Dotfiles/dotf/.config/libinput-gestures.conf ~/.config/libinput-gestures.conf
echo "[*] Done."
sleep 3 && clear

# Local
echo "[*] Copy local ..."
if ! [ -d $HOME/.local ]; then
	mkdir -p $HOME/.local
fi
ln -s ~/Dotfiles/dotf/.local/bin ~/.local/bin
ln -s ~/Dotfiles/dotf/.local/share/nemo ~/.local/share/nemo
echo "[*] Done."
sleep 3 && clear

# .Xresources
echo "[*] Copy .Xresources ..."
rm -f ~/.Xresources && ln -s ~/Dotfiles/dotf/.Xresources ~/.Xresources
echo "[*] Done."
sleep 3 && clear

# .gtkrc-2.0
echo "[*] Copy .gtkrc-2.0 ..."
rm -f ~/.gtkrc-2.0 && ln -s ~/Dotfiles/dotf/.gtkrc-2.0 ~/.gtkrc-2.0
echo "[*] Done."
sleep 3 && clear

##################### Install config WM #####################
read -p "[*] Do you want to use my WM configs? (1 for AwesomeWM/2 for mAWMcos/3 for AGS): " choice
if [ "$choice" = "1" ]; then
	echo "[*] Installing AwesomeWM ..."
	yay -S awesome-luajit-git lua-pam-git --noconfirm
	rm -rf ~/.config/awesome
	git clone https://github.com/sownteedev/dotfiles.git --depth=1 --branch=awesome ~/Dotfiles/awesome
	ln -s ~/Dotfiles/awesome ~/.config/awesome
	echo "[*] Done."
elif [ "$choice" = "2" ]; then
	echo "[*] Installing mAWMcos ..."
	yay -S awesome-luajit-git lua-pam-git --noconfirm
	rm -rf ~/.config/awesome
	git clone https://github.com/sownteedev/dotfiles.git --depth=1 --branch=mAWMcos ~/Dotfiles/mAWMcos
	ln -s ~/Dotfiles/mAWMcos ~/.config/awesome
	echo "[*] Done."
elif [ "$choice" = "3" ]; then
	echo "[*] Config for AGS is comming soon ^^"
fi
sleep 3 && clear

######################################## MY CONFIG FOR CUSTOM APPS #######################################

# Spotify
echo "[*] Installing Spotify and Youtube Music ..."
yay -S spotify --noconfirm
yay -S spicetify-cli-git --noconfirm
yay -S youtube-music --noconfirm
spotify &
sleep 5 && killall spotify
sudo chmod a+wr /opt/spotify
sudo chmod a+wr /opt/spotify/Apps -R
mkdir -p ~/.config/spicetify/Themes
ln -s ~/Dotfiles/dotf/.config/spicetify/Themes/Comfy ~/.config/spicetify/Themes/Comfy
spicetify config current_theme Comfy color_scheme Lunar inject_css 1 replace_colors 1 overwrite_assets 1 inject_theme_js 1
spicetify apply
echo "[*] Done."
sleep 3 && clear

# Firefox
echo "[*] Installing Zen Browser ..."
yay -S  zen-browser-bin firefox-pwa --noconfirm
xdg-settings set default-web-browser zen-alpha.desktop
echo "[*] Done."
sleep 3 && clear

# Grtub Theme
echo "[*] Installing Grub Theme ..."
sudo cp -r ~/Dotfiles/dotf/.root/grub/themes/virtuaverse /boot/grub/themes/virtuaverse
sudo sed -i 's/#GRUB_THEME=.*/GRUB_THEME=\/boot\/grub\/themes\/virtuaverse\/theme.txt/g' /etc/default/grub
sudo grub-mkconfig -o /boot/grub/grub.cfg
echo "[*] Done."
sleep 3 && clear

# Lightdm
echo "[*] Installing Lightdm ..."
yay -S --noconfirm lightdm lightdm-webkit2-greeter lightdm-webkit2-theme-glorious
sudo systemctl enable lightdm
sudo sed -i 's/#greeter-session=[^ ]*/greeter-session=lightdm-webkit2-greeter/' /etc/lightdm/lightdm.conf
sudo sed -i 's/^webkit_theme\s*=\s*\(.*\)/webkit_theme = glorious #\1/g' /etc/lightdm/lightdm-webkit2-greeter.conf
sudo sed -i 's/^debug_mode\s*=\s*\(.*\)/debug_mode = true #\1/g' /etc/lightdm/lightdm-webkit2-greeter.conf
sudo cp -r ~/Dotfiles/dotf/.walls /usr/share/backgrounds/walls
echo "[*] Done."
sleep 3 && clear

# Install TeVim
echo "[*] Installing TeVim ..."
sudo pacman -Rns neovim --noconfirm
yay -S --noconfirm lazygit xclip xsel fzf ripgrep neovim-nightly-bin
git clone https://github.com/sownteedev/TeVim.git --depth 1 ~/.config/nvim
ln -s ~/Dotfiles/dotf/.config/nvim/lua/custom ~/.config/nvim/lua/custom
echo "[*] Done."
sleep 3 && clear

# App for me
echo "[*] Installing apps for me ..."
sudo pacman -S --noconfirm telegram-desktop alacritty
yay -S --noconfirm notion-app-electron jetbrains-toolbox docker-desktop postman-bin github-desktop-bin ulauncher-git appimagelauncher-bin vesktop thunderbird anydesk-bin

# Caprine
yay -S --noconfirm caprine
ln -s ~/Dotfiles/dotf/.local/other/customcaprine.css ~/.config/Caprine/custom.css

# Zalo
sh -c "$(curl -sSL https://raw.githubusercontent.com/realdtn2/zalo-linux-unofficial/main/install_curl.sh)"

# MongoDB
# yay -S --noconfirm mongodb-bin mongodb-compass
# sudo systemctl enable mongodb

# My SQL
# yay -S --noconfirm mysql-workbench

# VMWare
# yay -S --noconfirm vmware-workstation
# sudo systemctl enable vmware-networks.service

# WPS
# yay -S --noconfirm wps-office libtiff5
# sudo sed -i '3i export XMODIFIERS="@im=ibus" export QT_IM_MODULE="ibus"' /usr/bin/wps /usr/bin/et /usr/bin/wpp
# sudo ln -s /usr/lib/libtiff.so.6 /usr/lib/libtiff.so.5
# sudo chmod -x /usr/lib/office6/wpsoffice

sudo pacman -Rns docker-desktop-debug --noconfirm
yay -S visual-studio-code-bin cursor-bin --noconfirm
echo "[*] Done."
sleep 3 && clear

sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
